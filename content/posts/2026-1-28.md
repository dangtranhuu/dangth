
### ğŸ”§ Quy Æ°á»›c chuáº©n cho repo `dangth`

* **Repo:** `dangth`
* **Branch deploy:** `release`
* **Environment:** production
* **Docker compose file:** `docker-compose.prod.yml`
* **Docker project name:** `dangth-prod`
* **SSH key (GitHub Actions):** `github_actions_dangth_prod`
* **ThÆ° má»¥c source trÃªn VPS:**


## BÆ°á»›c 1 â€” SSH vÃ o VPS báº±ng root vÃ  update há»‡ thá»‘ng

TrÃªn mÃ¡y cá»§a báº¡n (Windows/Mac/Linux), má»Ÿ terminal vÃ  SSH vÃ o VPS:

```bash
ssh root@<IP_VPS_CUA_BAN>
```

Sau khi vÃ o Ä‘Æ°á»£c VPS, cháº¡y:

```bash
apt update -y && apt upgrade -y
```

Xong bÆ°á»›c nÃ y, báº¡n nháº¯n láº¡i:

* â€œxong bÆ°á»›c 1â€
* vÃ  cho mÃ¬nh biáº¿t báº¡n Ä‘ang dÃ¹ng Ubuntu version nÃ o báº±ng lá»‡nh:

```bash
lsb_release -a
```

  ```
  /root/projects/dangth
  ```

---

## â® TÃ¬nh tráº¡ng hiá»‡n táº¡i

* âœ… Báº¡n Ä‘Ã£ xong **BÆ°á»›c 1** (update system)
* â­ Ta lÃ m láº¡i **BÆ¯á»šC 2** nhÆ°ng **Ä‘Ãºng tÃªn cho repo `dangth`**

---

## ğŸ‘‰ BÆ¯á»šC 2 â€” Táº¡o SSH KEY cho GitHub Actions (PROD â€“ dangth)

### 2.1 Táº¡o thÆ° má»¥c `.ssh` (náº¿u chÆ°a cÃ³)

```bash
mkdir -p /root/.ssh
chmod 700 /root/.ssh
```

---

### 2.2 Táº¡o SSH key cho GitHub Actions (production)

Cháº¡y **Ä‘Ãºng dÃ²ng nÃ y**:

```bash
ssh-keygen -t ed25519 -C "github-actions-dangth-prod" -f /root/.ssh/github_actions_dangth_prod
```

ğŸ‘‰ Khi há»i:

* `Enter passphrase` â†’ **ENTER**
* `Confirm passphrase` â†’ **ENTER**

---

### 2.3 Cho phÃ©p key SSH vÃ o root

```bash
cat /root/.ssh/github_actions_dangth_prod.pub >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys
```

---

### 2.4 Kiá»ƒm tra láº¡i

```bash
ls -la /root/.ssh
```

Báº¡n **pháº£i tháº¥y**:

```
github_actions_dangth_prod
github_actions_dangth_prod.pub
authorized_keys
```

---

## â›” LÆ¯U Ã QUAN TRá»ŒNG

* âŒ **ChÆ°a copy private key**
* âŒ **ChÆ°a Ä‘á»¥ng GitHub**
* âŒ **ChÆ°a cÃ i Docker**

Má»i thá»© Ä‘ang Ä‘Ãºng nhá»‹p ğŸ‘

---

### âœ… Khi báº¡n lÃ m xong

ğŸ‘‰ Nháº¯n:

> **xong bÆ°á»›c 2 (dangth prod)**

â¡ï¸ MÃ¬nh sáº½ Ä‘Æ°a **BÆ¯á»šC 3: cÃ i Docker + Docker Compose + Git (chuáº©n cho Ubuntu 22.04, production)**


Ráº¥t tá»‘t ğŸ‘ cáº¥u hÃ¬nh **Ä‘Ã£ khÃ¡ chuáº©n production rá»“i**, chá»‰ cáº§n **chá»‰nh nháº¹ Ä‘á»ƒ CI/CD clean & an toÃ n**, khÃ´ng phÃ¡ cÃ¡i Ä‘ang cháº¡y.

MÃ¬nh sáº½ **giá»¯ nguyÃªn logic cá»§a báº¡n**, chá»‰ â€œchuáº©n hoÃ¡ cho auto deployâ€.

---

## ğŸ‘‰ BÆ¯á»šC 5 (tiáº¿p) â€” Chuáº©n hoÃ¡ compose cho CI/CD (KHÃ”NG Ä‘á»•i app)

### 5.1 Váº¥n Ä‘á» nhá» trong file hiá»‡n táº¡i (giáº£i thÃ­ch nhanh)

File `docker-compose.yml` cá»§a báº¡n **cháº¡y Ä‘Æ°á»£c**, nhÆ°ng khi CI/CD thÃ¬ cÃ³ 2 Ä‘iá»ƒm khÃ´ng tá»‘i Æ°u:

1. âŒ `image: dangth:2025-10-18`
   â†’ má»—i láº§n deploy láº¡i **build image má»›i nhÆ°ng tÃªn image cá»‘ Ä‘á»‹nh**, dá»… rÃ¡c image
2. âŒ `container_name: dangth`
   â†’ náº¿u sau nÃ y cháº¡y nhiá»u env (stage/prod) sáº½ **Ä‘á»¥ng tÃªn**

ğŸ‘‰ Ta sáº½:

* **Giá»¯ file hiá»‡n táº¡i** Ä‘á»ƒ cháº¡y tay
* Táº¡o **file riÃªng cho CI/CD production**

---

## ğŸ‘‰ BÆ¯á»šC 5.2 â€” Táº¡o `docker-compose.prod.yml`

Trong thÆ° má»¥c `/root/projects/dangth`:

```bash
cp docker-compose.yml docker-compose.prod.yml
```

Má»Ÿ file:

```bash
nano docker-compose.prod.yml
```

### âœï¸ Ná»™i dung CHUáº¨N PROD (báº¡n thay toÃ n bá»™)

```yaml
services:
  dangth:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dangth-prod
    environment:
      - NODE_ENV=production
      - PORT=1210
    ports:
      - "1210:1210"
    restart: unless-stopped
    networks:
      - webnet

networks:
  webnet:
```

ğŸ”´ **ÄÃ£ cá»‘ tÃ¬nh bá»**:

* `image:` â†’ Ä‘á»ƒ Docker tá»± build image theo source má»›i má»—i deploy

---

## ğŸ‘‰ BÆ¯á»šC 5.3 â€” Test láº¡i 1 láº§n (báº¯t buá»™c)

```bash
docker compose -p dangth-prod -f docker-compose.prod.yml down --remove-orphans
docker compose -p dangth-prod -f docker-compose.prod.yml up -d --build
```

Check:

```bash
docker ps
docker logs -f dangth-prod
```

ğŸ‘‰ Náº¿u app cháº¡y bÃ¬nh thÆ°á»ng nhÆ° trÆ°á»›c lÃ  **100% OK**.

---

## â— Dockerfile cá»§a báº¡n: ÄÃNH GIÃ NHANH

Dockerfile báº¡n gá»­i lÃ  **chuáº©n chá»‰nh** ğŸ‘
âœ” multi-stage
âœ” alpine
âœ” khÃ´ng leak dev deps
âœ” expose + start Ä‘Ãºng port

ğŸ‘‰ **KHÃ”NG cáº§n sá»­a gÃ¬** cho CI/CD.

---

### âœ… Khi xong

Nháº¯n:

> **xong bÆ°á»›c 5 (prod compose ok)**

â¡ï¸ MÃ¬nh sáº½ Ä‘i tiáº¿p **BÆ¯á»šC 6: táº¡o GitHub Actions workflow auto deploy (push branch `release` â†’ prod VPS)**
ğŸ‘‰ BÆ°á»›c nÃ y xong lÃ  **tá»« nay chá»‰ cáº§n `git push` lÃ  server tá»± update** ğŸš€
